(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[489],{84679:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/confirm-configuration",function(){return s(19742)}])},98064:function(e,t,s){"use strict";s.d(t,{I:function(){return l}});var r=s(85893),a=s(39618),n=s(63029),i=s(62971);let l=e=>{let{recipients:t}=e,s=(0,n.Z)(t.map(e=>e.address));return(0,r.jsx)(a.iA,{columns:[{accessorKey:"operator",header:"Address"},{accessorKey:"split",header:"Split",css:{width:"70px"}}],rows:t.map((e,t)=>({operator:(0,r.jsx)(i.M,{ensName:s[t],address:e.address}),split:"".concat(e.split||e.percentAllocation," %")}))})}},19742:function(e,t,s){"use strict";s.r(t);var r=s(85893),a=s(71866),n=s(64146),i=s(4010),l=s(39618),c=s(9324),o=s(41518),d=s(87536),u=s(2504),p=s(61279),h=s(80050),y=s(11163),f=s(67294),m=s(98064),x=s(37005),g=s(4579),w=s(28106);let j=()=>{let{account:e,provider:t,chainId:s}=(0,u.kR)(),{handleSubmit:j}=(0,d.cI)({mode:"onChange"}),v=(0,y.useRouter)(),[S,_]=(0,f.useState)(),[b,C]=(0,f.useState)(),[A,T]=(0,f.useState)(!1),[k,E]=(0,f.useState)(),[N,R]=(0,f.useState)(),[I,M]=(0,f.useState)(),[F,$]=(0,f.useState)(),[D,O]=(0,f.useState)(!1),[W,K]=(0,f.useState)(""),[V,H]=(0,f.useState)(""),[L,X]=(0,f.useState)(null),[Y,z]=(0,f.useState)("Deploy Validator Reward Splitter"),B="v1.7.0",[P,U]=(0,f.useState)(!1),[Z,q]=(0,f.useState)(""),J=(0,o.o)(e=>e.clusterDefinition),Q=null==J?void 0:J.operators.some(t=>t.address===e),G=(0,o.o)(e=>e.updateClusterDefinition),ee=(0,o.o)(e=>e.completeLeaderStep),et=(0,o.o)(e=>e.enableLeaderStep);(0,o.o)(e=>e.getStepByRoute(v.pathname));let es=()=>{_(null),C(null),E(null),R(null),M(null),T(!1)},er=e=>{console.log(e),es()};if((0,f.useEffect)(()=>{t&&X(new n.Contract(c.tm,i.Mt,null==t?void 0:t.getSigner(0)))},[t]),(0,f.useEffect)(()=>{if(S){let r=async()=>{let r={creator_config_hash:S.config_hash},a=await (0,p.L6)(t,s,e,r);$(a)};if(r(),Q){let r=async()=>{try{let r={operator_config_hash:S.config_hash},a=await (0,p.AM)(t,s,e,r);M(a);let n={enr:null==J?void 0:J.enr},i=await (0,p.Ol)(t,s,e,n);R(i)}catch(e){er(e)}};r().catch(er)}}},[S]),(0,f.useEffect)(()=>{if(F&&S){let e=async()=>{let e=await (0,h.c0)({token:F,data:S});if(!e.data.config_hash)throw"no config hash returned";E(e.data.config_hash)};e().catch(er)}},[F,S]),(0,f.useEffect)(()=>{if(Q&&N&&I&&k){let t=async()=>{let t={address:e,enr:null==J?void 0:J.enr,enr_signature:N,fork_version:c.se,version:B},{data:s}=await (0,h.R)({token:I,data:t,configHash:k});C(s)};t().catch(er)}},[N,k]),(0,f.useEffect)(()=>{if(Q&&b&&k||!Q&&k){ee("confirm-configuration");let e=et("invite-group");T(!1),v.push({pathname:e.href,query:{configHash:k}})}},[b,k]),!J)return(0,r.jsx)(l.xv,{children:"No cluster data ..."});let ea=async()=>{try{let e=[...J.recipients];e.sort((e,t)=>e.address.localeCompare(t.address));let r=e.map(e=>e.address),a=e.map(e=>{let t=(1e4*parseFloat(e.split)).toFixed(0);return parseInt(t)}),n=await L.predictImmutableSplitAddress(r,a,c.Uu);console.log("predictedSplitAddress",n);let i=await (0,g.Kv)(n,s);if(i){q(c.Oy);return}let l=await (0,g.u_)({accounts:r,percentAllocations:a},J.principal,J.validatorsSize,t.getSigner(0));if(console.log(l,"validatorRewardSplitterAddresses"),Array.isArray(l)){let e=l[0].map(e=>({feeRecipientAddress:l[1],withdrawalAddress:e}));G({...J,validators:e}),z("Validator Reward Splitter Deployed Successfully"),H(l[1])}}catch(e){q(null==e?void 0:e.message)}},en=async e=>{if(e.preventDefault(),!D){O(!0);try{await ea(),O(!1)}catch(e){console.log(e,"errr"),O(!1)}}},ei=async()=>{console.log(JSON.stringify(J),"currentClusterData");let e=(0,p.KH)(J,B);console.log(e.config_hash,"config_hashconfig_hash"),_(e),T(!0)};(0,p.zT)(null==J?void 0:J.clusterSize);let el=()=>(0,r.jsx)(l.W2,{className:"cluster-details",alignItems:"start",children:(0,r.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,r.jsx)(w.uo,{}),(0,r.jsx)(a.VL,{operators:[...null==J?void 0:J.operators],currentAccount:e})]})}),ec=()=>(0,r.jsxs)(l.W2,{className:"enr-section",alignItems:"start",css:{gap:"$lg"},children:[(0,r.jsxs)(l.kC,{direction:"column",css:{gap:"$sm"},children:[(0,r.jsxs)(l.kC,{css:{alignItems:"center",gap:"$xxxs"},children:[(0,r.jsx)(l.xv,{variant:"subline",color:"body",css:{textTransform:"uppercase"},children:"Your Charon client ENR"}),(0,r.jsx)(l.KZ,{content:'An ENR is an "Ethereum Node Record" used to identify your client to the other clients in the cluster"',children:(0,r.jsx)(l.xu,{css:{display:"flex"},children:(0,r.jsx)(l.by,{})})})]}),(0,r.jsx)(a.Kx,{css:{minHeight:"115px"},placeholder:"Your enr",value:null==J?void 0:J.enr,readOnly:!0})]}),(0,r.jsxs)(l.rU,{href:"https://docs.obol.tech/docs/next/int/faq/errors#enrs-keys",target:"_blank",children:["More on Ethereum Node Records ",(0,r.jsx)(l.ZJ,{})]})]});return(0,r.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,r.jsx)(l.xv,{variant:"h3",children:"Confirm Configuration"}),(0,r.jsxs)(a.l0,{onSubmit:j(ei),children:[(0,r.jsx)(x.T,{name:"reward_split_withdrawal_flow",children:(null==J?void 0:J.principal)&&!(null==J?void 0:J.singleAddress)&&(0,r.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,r.jsx)(el,{}),(0,r.jsx)(w.XD,{}),Q&&(0,r.jsx)(ec,{}),(0,r.jsxs)(l.W2,{className:"withdrawal-section",css:{gap:"$xl"},alignItems:"start",children:[(0,r.jsx)(l.xv,{variant:"h4",children:"Split Addresses"}),(0,r.jsx)(m.I,{recipients:J.recipients}),V&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(a.VL,{operators:J.validators.map(e=>({address:e.withdrawalAddress})),currentAccount:e,header:"Validator Withdrawal Contract Addresses"})}),(0,r.jsx)(a.fl,{color:"primary",type:"button",onClick:en,disabled:"Validator Reward Splitter Deployed Successfully"==Y||!!Z,children:(0,r.jsxs)(r.Fragment,{children:[D&&(0,r.jsx)(l.yC,{}),Y]})}),Z&&(0,r.jsx)(l.xv,{variant:"metadata",color:"test",children:Z})]}),(0,r.jsx)(l.kC,{direction:"column",children:(0,r.jsxs)(l.W2,{className:"enr-section",alignItems:"start",css:{gap:"$lg"},children:[(0,r.jsx)(l.kC,{direction:"column",css:{gap:"$xs"},children:(0,r.jsx)(l.xv,{variant:"h4",children:"Confirm Details "})}),(0,r.jsxs)(l.kC,{direction:"column",css:{gap:"$xl"},children:[(0,r.jsxs)(l.kC,{css:{gap:"$xs",width:"$full"},children:[(0,r.jsx)(l.xu,{children:(0,r.jsx)(l.XZ,{checked:P,onCheckedChange:()=>U(!P)})}),(0,r.jsx)(l.xv,{variant:"body",children:"You will be prompted to sign a message with your wallet. This signature is attesting to the fact that:"})]}),(0,r.jsx)(l.sQ,{heading:"You have confirmed the withdrawal address for the validators to be created is correct. If this address is a contract, you have confirmed the contract implementation is correct. If this address is an externally-owned account, you have confirmed that the EOA custody is secure."}),(0,r.jsx)(l.sQ,{heading:"You have submitted your charon node's Ethereum Node Record (ENR) correctly. This signature is the authorisation of this charon client to act on your behalf."})]}),(0,r.jsx)(a.fl,{color:"primary",type:"submit",disabled:!V||!P,children:(0,r.jsxs)(r.Fragment,{children:[A&&(0,r.jsx)(l.yC,{}),"Confirm and Sign"]})})]})})]})}),!(null==J?void 0:J.principal)&&(null==J?void 0:J.singleAddress)&&(0,r.jsx)(x.T,{name:"single_reward_address_flow",children:(0,r.jsxs)(l.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,r.jsx)(el,{}),(0,r.jsx)(w.XD,{}),Q&&(0,r.jsx)(ec,{}),(0,r.jsxs)(l.W2,{className:"withdrawal-section",css:{gap:"$lg"},alignItems:"start",children:[(0,r.jsx)(l.xv,{variant:"h4",children:"Withdrawal Addresses"}),(0,r.jsx)(w.nB,{heading:"Principal Address",description:"The withdrawal address or contract will receive 100%.",value:null==J?void 0:J.singleAddress,className:"single-address-section"}),(0,r.jsx)(w.nB,{heading:"Fee Recipient Address",description:"Address to receive transaction fees from block proposals.",value:null==J?void 0:J.feeRecipientAddress,className:"fee-recipient-address-section"})]}),(0,r.jsx)(l.kC,{direction:"column",children:(0,r.jsx)(l.zx,{color:"primary",type:"submit",css:{"& div":{m:0}},"data-testid":"confirm-config-button",children:(0,r.jsxs)(r.Fragment,{children:[A&&(0,r.jsx)(l.yC,{}),"Confirm and Sign"]})})})]})})]})]})};t.default=j,j.layout="ProgressTrackerLayout"},4579:function(e,t,s){"use strict";s.d(t,{Kv:function(){return u},u_:function(){return d},Np:function(){return p},h_:function(){return h}});var r=s(9279),a=s(64146),n=s(34858),i={abi:[{inputs:[{internalType:"address",name:"_waterfallFactoryModule",type:"address"},{internalType:"address",name:"_splitMain",type:"address"},{internalType:"string",name:"_ensName",type:"string"},{internalType:"address",name:"_ensReverseRegistrar",type:"address"},{internalType:"address",name:"_ensOwner",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{components:[{internalType:"address[]",name:"accounts",type:"address[]"},{internalType:"uint32[]",name:"percentAllocations",type:"uint32[]"},{internalType:"uint32",name:"distributorFee",type:"uint32"},{internalType:"address",name:"controller",type:"address"}],internalType:"struct SplitConfiguration",name:"_split",type:"tuple"},{internalType:"address payable",name:"_principal",type:"address"},{internalType:"uint256",name:"_numberOfValidators",type:"uint256"}],name:"createETHRewardSplit",outputs:[{internalType:"address[]",name:"withdrawalAddresses",type:"address[]"},{internalType:"address",name:"rewardSplitContract",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"splitMain",outputs:[{internalType:"contract ISplitMain",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"waterfallFactoryModule",outputs:[{internalType:"contract IWaterfallFactoryModule",name:"",type:"address"}],stateMutability:"view",type:"function"}]},l=s(9324),c=s(80050);let o=r.d;async function d(e,t,s,r){try{let n=new a.Contract(l.AB,i.abi,r),c=await n.callStatic.createETHRewardSplit({accounts:e.accounts,percentAllocations:e.percentAllocations,distributorFee:l.Uu,controller:o},t,s),d=await n.createETHRewardSplit({accounts:e.accounts,percentAllocations:e.percentAllocations,distributorFee:l.Uu,controller:o},t,s);return await d.wait(),c}catch(e){throw Error(e)}}async function u(e,t){try{let s=await (0,c.er)({chainId:t,splitId:e});if(console.log(s,"splitMetadata"),s)return!0;return!1}catch(e){return Error(e)}}let p=async e=>{let{chainId:t,splitId:s,provider:a}=e,i=new n.SplitsClient({chainId:t,provider:a,signer:a.getSigner(0)});try{let e=await i.distributeToken({splitId:s,token:r.d}),{transactionHash:t}=e.event;return t}catch(e){throw Error(e)}},h=async e=>{let{chainId:t,provider:s,address:a}=e,i=new n.SplitsClient({chainId:t,provider:s,signer:s.getSigner(0)});try{let e=await i.withdrawFunds({address:a,tokens:[r.d]}),{transactionHash:t}=e.event;return t}catch(e){throw Error(e)}}}},function(e){e.O(0,[10,774,888,179],function(){return e(e.s=84679)}),_N_E=e.O()}]);